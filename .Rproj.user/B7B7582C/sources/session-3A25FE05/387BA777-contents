estimate_targets <- function(data, weightvar = NULL) {
  
  data$w <- data[, weightvar]

  if( nrow(data) > 0 ){

    crashes <- data %>% filter(impact_speed0 > 0 & w > 0)
    
    mean_impact_speed0 <- with(crashes, sum(w * (impact_speed0)) / sum(w))
    mean_impact_speed1 <- with(crashes, sum(w * (impact_speed1)) / sum(w))
    mean_impact_speed_reduction <- mean_impact_speed0 - mean_impact_speed1
    percent_impact_speed_reduction <- 100 * mean_impact_speed1 / mean_impact_speed0
    mean_injury_risk0 <- with(crashes, sum(w * (injury_risk0)) / sum(w))
    mean_injury_risk1 <- with(crashes, sum(w * (injury_risk1)) / sum(w))
    mean_injury_risk_reduction <- mean_injury_risk0 - mean_injury_risk1
    percent_injury_risk_reduction <- 100 * mean_injury_risk1 / mean_injury_risk0
    crash_avoidance_rate <- 1 - with(crashes, sum(w * (impact_speed1 > 0)) / sum(w))
    
    impact_speed0_logmean <- with(crashes, sum(w * log(impact_speed0)) / sum(w))
    impact_speed0_logSD <- with(crashes, sqrt(sum(w * (log(impact_speed0) - impact_speed0_logmean)^2) / sum(w)))
    
  } else {
    
    mean_impact_speed0 <- NA
    mean_impact_speed1 <- NA
    mean_impact_speed_reduction <- mean_impact_speed0 - mean_impact_speed1
    percent_impact_speed_reduction <- 100 * mean_impact_speed1 / mean_impact_speed0
    mean_injury_risk0 <- NA
    mean_injury_risk1 <- NA
    mean_injury_risk_reduction <- mean_injury_risk0 - mean_injury_risk1
    percent_injury_risk_reduction <- 100 * mean_injury_risk1 / mean_injury_risk0
    crash_avoidance_rate <- NA
    
    impact_speed0_logmean <- NA
    impact_speed0_logSD <- NA
    
  }
  
  return(c("mean_impact_speed0" = mean_impact_speed0, 
           "mean_impact_speed1" = mean_impact_speed1, 
           "mean_impact_speed_reduction" = mean_impact_speed_reduction, 
           "percent_impact_speed_reduction" = percent_impact_speed_reduction, 
           "mean_injury_risk0" = mean_injury_risk0, 
           "mean_injury_risk1" = mean_injury_risk1, 
           "mean_injury_risk_reduction" = mean_injury_risk_reduction, 
           "percent_injury_risk_reduction" = percent_injury_risk_reduction, 
           "crash_avoidance_rate" = crash_avoidance_rate, 
           "impact_speed0_logmean" = impact_speed0_logmean,
           "impact_speed0_logSD" = impact_speed0_logSD))
}