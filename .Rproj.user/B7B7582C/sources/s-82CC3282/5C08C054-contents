
library("readxl")
library("tidyverse")
library("writexl")

# Import baseline glance distribution.
BaselineGlanceDist <- read_csv("Data/BaselineGlanceDist.csv", col_names = FALSE) %>% 
  dplyr::rename(t = X1, count = X2)

# Fit lognormal model to glance distribution.
zeroProb <- BaselineGlanceDist$count[1] / sum(BaselineGlanceDist$count)

x <- with(BaselineGlanceDist %>% filter(t > 0), rep(t, count))
fit <- fitdistrplus::fitdist(x, "lnorm")

glance <- BaselineGlanceDist %>% 
  mutate(relfreq = count / sum(count), 
         fitted_prob = dlnorm(t, meanlog  = fit$estimate["meanlog"], sdlog = fit$estimate["sdlog"]),
         fitted_prob = (t == 0) * zeroProb + (t > 0) * (1 - zeroProb) * fitted_prob / sum(fitted_prob)) # Normalise.

# Derive overshot distribution.
overshot <- glance %>%
  mutate(prob = rev(cumsum(rev(fitted_prob / 1:length(fitted_prob)))),
         prob = prob / sum(prob)) %>% # Normalise.
  dplyr::select(-count, -relfreq, -fitted_prob) %>% 
  filter(t > 0) %>% 
  mutate(prob = prob / sum(prob))

# Export to xlsx.
write_xlsx(overshot, "Data/OvershotDist.xlsx")